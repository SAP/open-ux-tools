<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{{appTitle}}</title>

        <script>
            window['sap-ushell-config'] = {
                defaultRenderer: 'fiori2',
                applications: {
                    'preview-app': {
                        additionalInformation: 'SAPUI5.Component=v2flex',
                        applicationType: 'URL',
                        url: './',
                        navigationMode: 'embedded'
                    }
                }
            };
        </script>
        <script src="/test-resources/sap/ushell/bootstrap/sandbox.js"></script>
        <script
            src="/resources/sap-ui-core.js"
            data-sap-ui-libs="sap.m, sap.ushell, sap.ui.core, sap.ui.comp, sap.ui.table, sap.suite.ui.generic.template, sap.ui.generic.app, sap.ui.rta"
            data-sap-ui-async="true"
            data-sap-ui-preload="async"
            data-sap-ui-xx-designMode="true"
            data-sap-ui-compatVersion="edge"
            data-sap-ui-theme="sap_fiori_3"
            data-sap-ui-resourceroots='{
                  "v2flex": "."
              }'
            data-sap-ui-frameOptions="allow"
            data-sap-ui-bindingSyntax="complex"
            data-sap-ui-xx-componentPreload="off"
            data-sap-ui-xx-suppressDeactivationOfControllerCode="true"
            data-sap-ui-xx-viewCache="false"
            data-sap-ui-flexibilityServices='[{"applyConnector": "v2flex/WorkspaceConnector", "writeConnector": "v2flex/WorkspaceConnector", "custom": true}]'></script>
        <script
            id="locate-reuse-libs"
            src="./utils/locate-reuse-libs.js"
            data-sap-ui-manifest-uri="./manifest.json"
            data-sap-ui-componentName="v2flex"
            data-sap-ui-use-mockserver="true"></script>
        <!-- relevant for version < 1.78.0 only -->
        <script src="./test/changes_preview.js"></script>
        <script>
            sap.ui.getCore().attachInit(function () {
                console.info('After init');
                sap.ushell.Container.attachRendererCreatedEvent(function () {
                    console.info('attachRendererCreatedEvent');
                    sap.ushell.Container.getServiceAsync('AppLifeCycle').then((serviceInstance) => {
                        serviceInstance.attachAppLoaded((event) => {
                            console.info('attachAppLoaded', event);
                            const view = event.getParameter('componentInstance');
                            sap.ui.require(
                                ['sap/ui/rta/RuntimeAuthoring', 'sap/ui/fl/Layer', 'sap/ui/base/BindingParser', ],
                                async function (RuntimeAuthoring, Layer, BindingParser) {
                                    const layer = Layer.VENDOR;
                                    const options = {
                                        rootControl: view,
                                        flexSettings: {
                                            layer,
                                            developerMode: true
                                        }
                                    };
                                    BindingParser._keepBindingStrings = true;
                                    const rta = new RuntimeAuthoring(options);
                                    await rta.start();
                                    const { init } = await import('/ui5-adaptation/index.js');
                                    await init({
                                        rta,
                                        componentId: 'v2flex',
                                        layer,
                                        generator: 'SAPFioriTools-adaptation'
                                    });
                                }
                            );
                        });
                    });
                });
            });
        </script>
    </head>

    <body class="sapUiBody" id="content"></body>
</html>
