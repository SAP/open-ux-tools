{
  "id": "fiori-samples-misc-s4hana-readme-md",
  "title": "SAMLAssertion destination configured to point SAP S/4HANA Cloud Public tenant",
  "category": "samples",
  "path": "misc/s4hana/README.md",
  "lastModified": "2025-09-01T18:17:10.808Z",
  "tags": [
    "samples",
    "md",
    "SAMLAssertion",
    "destination",
    "configured",
    "point",
    "SAP",
    "4HANA",
    "Cloud",
    "Public",
    "tenant"
  ],
  "headers": [
    "SAMLAssertion destination configured to point SAP S/4HANA Cloud Public tenant",
    "Prerequisites",
    "Create a SAP BTP SAMLAssertion Destination to consume V2 and V4 OData Catalogs",
    "How SAMLAssertion Works",
    "NameID Format in SAP BTP Destination",
    "Authorization Requirements",
    "Tenant Types",
    "Developer Extensibility (SAP Client 080)",
    "Key User Extensibility/Customizing (SAP Client 100)",
    "Steps for Developer Extensibility Tenant",
    "Debugging Connectivity Issues",
    "Option 1. Authorisation Failures",
    "Option 2. Connectivity Failures",
    "Option 3. Bypassing Business Application Studio",
    "Debugging Deployment Issues",
    "Issue 1. Deployment fails with `The use of Gateway OData V2 Service Z_MY_SERVICE 0001 is not permitted`",
    "Issue 2. Deployment fails with HTTP 403",
    "Issue 3. Deployment fails with HTTP 400",
    "Issue 4. Calling OData V2 or V4 Catalogs does not include specific OData services",
    "Issue 5. Support Communication Users",
    "Issue 6. Standard OData services not showing in RecommendedServiceCollection",
    "Related Links",
    "License"
  ],
  "content": "# SAMLAssertion destination configured to point SAP S/4HANA Cloud Public tenant\n\n# Prerequisites\n1. You have completed Step 2 and Step 3 https://developers.sap.com/tutorials/abap-custom-ui-bas-connect-s4hc.html as this will create the System to System trust required to enable SAML between the respective systems.\n1. You have administrative access to your S/4HANA Cloud system to allow to configure and debug connectivity issues.\n1. You are subscribed to SAP Business Application Studio, follow this [tutorial](https://help.sap.com/docs/SAP%20Business%20Application%20Studio/9d1db9835307451daa8c930fbd9ab264/6331319fd9ea4f0ea5331e21df329539.html) for more information\n1. You have reviewed the FAQ on [SAP S/4HANA Cloud, Public Edition](https://me.sap.com/notes/3445942) documentation\n1. You have reviewed the [SAP Business Application Studio Integration with SAP S/4HANA Cloud](https://me.sap.com/notes/3297481) documentation\n\n## Create a SAP BTP SAMLAssertion Destination to consume V2 and V4 OData Catalogs\n1. Open [s4hana-cloud_saml](s4hana-cloud_saml) file using any text editor or browser\n1. Replace all instances of `my1111111` with your specific hostname\n1. Log in to your SAP BTP subaccount, select the `Destinations` tab, and select `Import Destination`\n1. You have now created a SAB BTP subaccount destination using `odata_abap` to reflect the type of destination created\n1. Login to your SAP Business Application Studio to consume the new destination to validate that your connectivity is working\n\nYou can refer to this link to confirm your destination is configured correctly;\nhttps://help.sap.com/docs/SAP_S4HANA_CLOUD/0f69f8fb28ac4bf48d2b57b9637e81fa/31876c06f99645f289d802f9c95fb62b.html\n\n__Note: In some cases, you might want to create an `odata_gen` SAP BTP destination to consume a specific OData service, then refer to this [tutorial](https://ga.support.sap.com/dtp/viewer/index.html#/tree/3046/actions/45995:48363:53594:54336) to create a Full or Partial URL destination. This scenario is typical where a user does not have access to the Catalog but only individual services__\n\n## How SAMLAssertion Works\n\n1. SAP BTP, typically configured with a local SAML Identity Providers (IdP), sends a SAML Assertion (including the SAML Issuer and signature) to SAP S/4HANA Cloud, Public Edition (SAML SP).\n1. The Communication System on SAP S/4HANA Cloud validates the SAML Issuer and signature.\n1. It then maps the user ID and ID format.\n1. The user with the same subject ID must exist in both the SAP S/4HANA Cloud and SAP BTP systems.\n\n### NameID Format in SAP BTP Destination\nIn your SAP BTP destination, the `nameIdFormat` property affects the behavior of user ID mapping against your SAP S/4HANA Cloud instance\n* `urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress` - User ID maps to the email address\n* `urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified` - User ID maps to the username\n\nUnless you have a specific technical reason, the default should be `urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress` as the `nameIdFormat`. The email address as defined in your IdP i.e OpenID Connect or IAS must match the S4HC email address configured with the appropriate roles. Please refer to the related links section below to understand more around adding other IdP's to your SAB BTP system.\n\n## Authorization Requirements\nDifferent authorizations are required for various operations in SAP S/4HANA Cloud, such as:\n\n* Accessing catalog services to browse available OData Services\n* Running previews and accessing OData Services\n* Deploying SAPUI5 applications in S/4HANA Cloud\n\nYou will be required to add the specific `Business Role` to allow a specific user to `deploy` and `undeploy` SAPUI5 applications. All other users can be assigned the `OData Services` role;\n\n| Business Catalog | Key User Extensibility/Customizing(client 100)  | Developer Extensibility (client 080) |\n| ------------- | ------------- |--------------------------------------|\n| To access OData Services | SAP_CORE_BC_EXT_TST  | SAP_CORE_BC_EXT_TST                  |\n| To deploy application | SAP_CORE_BC_EXT_UI  | SAP_A4C_BC_DEV_UID_PC                |\n| Business Role | SAP_BR_EXTENSIBILITY_SPEC  | SAP_BR_DEVELOPER        |\n\nBusiness roles need to be created based on business role templates, the recommended business role templates are `SAP_BR_DEVELOPER` and `SAP_BR_EXTENSIBILITY_SPEC`.\n\nPlease note, in some instances, the name of the business role might defer or in some cases the specific business catalogs are added to an existing business role that is not `SAP_BR_DEVELOPER` or `SAP_BR_EXTENSIBILITY_SPEC` for example  `BR_DEVELOPER` or in some instances `Z_BR_DEVELOPER`.\n\nTo better understand the roles, please refer to [link](https://help.sap.com/docs/SAP_S4HANA_CLOUD/0f69f8fb28ac4bf48d2b57b9637e81fa/a71e8ffa917545c8af0a7c77992f8eba.html?q=SAP_CORE_BC_EXT_UI).\n\n## Tenant Types\n\n__Developer Note__\nThe following information is based on the SAP S/4HANA Cloud (3SL) version where the tenant type is defined as `Developer Extensibility` or `Key User Extensibility/Customizing` and requires a different SAP BTP destination to reflect the different host endpoints. As a consequence, there will be a new communication system along with the associated SSL Certificate exposed per host or tenant type.\n\n### Developer Extensibility (SAP Client 080)\n**Purpose:** Facilitates developer extensibility within the SAP S/4HANA Cloud ABAP environment.\n**Features:**\n- Provides full ABAP development tool access to released SAP S/4HANA Cloud business objects and extension points.\n- Supports the creation of advanced, cloud-ready, and upgrade-stable custom ABAP code.\n- Ensures that development objects are client-independent, allowing access from other tenants if permissions are granted.\n- Build your custom developments based on lifecycle-stable SAP objects.\n- Only developer extensibility is supported.\n\nSteps to generate a [SAP BTP destination for your S/4HANA Cloud Developer Extensibility tenant](https://help.sap.com/docs/SAP_S4HANA_CLOUD/0f69f8fb28ac4bf48d2b57b9637e81fa/0af2819bbe064a3da455753c8518dd81.html?version=2502.500)\n\n### Key User Extensibility/Customizing (SAP Client 100)\n**Purpose:** Serves as the primary environment for configuration and customization activities.\n**Features:**\n- Allows for the setup and adjustment of system settings to meet specific business requirements.\n- Acts as a bridge between development and testing activities, ensuring that custom developments are appropriately integrated and tested\n- Configuration activities based on the reference content from SAP Central Business Configuration.\n- To make your configuration content available in the test and production systems, you need to transport them.\n- Create low-code custom developments in key user apps.\n- In Customizing Tenant, only Key User Extensibility is supported.\n- Form Templates are under the Key User Extensibility category, so you can only create a Form Template in customizing tenants.\n\nSteps to generate a [SAP BTP destination for your S/4HANA Cloud Key User Extensibility/Customizing tenant](https://help.sap.com/docs/SAP_S4HANA_CLOUD/0f69f8fb28ac4bf48d2b57b9637e81fa/31876c06f99645f289d802f9c95fb62b.html?version=2502.500)\n\n### Steps for Developer Extensibility Tenant\n\nTo ensure your specific user has the appropriate `SAP_BR_DEVELOPER` role to consume OData XML services, and deploy SAPUI5 applications, edit your specific S4HC user;\n\nSearch for application `Maintain Business Users`;\n![MaintainUsersPart1.png](MaintainUsersPart1.png)\n\nSelect your specific user and select `Assigned Business Roles`;\n\n![MaintainUsersPart1.png](MaintainUsersPart2.png)\n\nIf `SAP_BR_DEVELOPER` is missing, select `Add` and search for `SAP_BR_DEVELOPER` to append the Business Role to your specific user.\n\nNext, select the `SAP_BR_DEVELOPER` role that you just added, select `Business Catalogs`and ensure `SAP_CORE_BC_EXT_TST` and `SAP_A4C_BC_DEV_UID_PC` are added;\n\n![MaintainUsersPart1.png](MaintainUsersPart3.png)\n\nThe same steps can be used to append the business role `SAP_BR_EXTENSIBILITY_SPEC` for a `Key User Extensibility/` tenant.\n\n## Debugging Connectivity Issues\n\n### Option 1. Authorisation Failures\n\nYou can also review the `Display Authorization Trace` as an S/4HANA Administrator on your instance;\n\nhttps://help.sap.com/docs/SAP_S4HANA_CLOUD/55a7cb346519450cb9e6d21c1ecd6ec1/ebb91d3758c441b18bf9ebd0798d424e.html\n\n- Typical criteria is Status: `Failed`\n- Typical criteria is `Users`, filtered by the required user details, you will need to select the user from the list\n\n### Option 2. Connectivity Failures\n\nUsing the search option on your S/4HANA instance, you can also review the failed requests using the `Display Connectivity Trace` as an S/4HANA Administrator;\n\nFilter by request path = `/sap/opu/odata/IWFND/CATALOGSERVICE` to see calls to V2 catalog service, request method is `GET`\n\nFilter by request path = `/sap/opu/odata4/iwfnd/config/default/iwfnd/catalog/` to see calls for V4 catalog service, request method is `GET`\n\nRefer to this link for more information;\n\n[https://help.sap.com/docs/SAP_S4HANA_CLOUD/0f69f8fb28ac4bf48d2b57b9637e81fa/a4f6ccd072f147f299b1d856062c8dc8.html](https://help.sap.com/docs/SAP_S4HANA_CLOUD/0f69f8fb28ac4bf48d2b57b9637e81fa/a4f6ccd072f147f299b1d856062c8dc8.html)\n\nSearch for the application `Display Connectivity Trace`;\n\n![DisplayConnectivityPart1.png](DisplayConnectivityPart1.png)\n\nDefine a new Trace using the `Request Method` of `GET` and the `Path Prefix` of `/sap/opu/odata/IWFND/CATALOGSERVICE`, click save;\n![DisplayConnectivityPart1.png](DisplayConnectivityPart2.png)\n\nThe new trace will populate the table if new events are found;\n\n![DisplayConnectivityPart1.png](DisplayConnectivityPart3.png)\n\n### Option 3. Bypassing Business Application Studio\n\nAnother option is to create a dynamic destination URL;\n\n__You need to ensure you are subscribed to [SAP Build Work Zone](https://developers.sap.com/tutorials/cp-portal-cloud-foundry-getting-started.html) to ensure the `dynamic_dest` path is exposed on your SAP BTP subaccount__\n\n1. Get the name of your SAP BTP subaccount destination configured using SAMLAssertion i.e. `mys4hc-destination`\n1. Ensure the SAP BTP destination `Additional Properties` contains `HTML5.DynamicDestination: true` and `WebIDEEnabled: true`\n1. Get the name of your `Subdomain` and `API endpoint` by opening your SAP BTP subaccount `overview` page, i.e. subdomain is `mytrial-account-staging` and API endpoint is `https://api.cf.eu10.hana.ondemand.com`\n\nUsing the following template, replace the required parameters;\n\n```\nhttps://<your-subaccount-subdomain>.launchpad.cfapps.<your-region-api-endpoint>.hana.ondemand.com/dynamic_dest/<your-destination-name>/<path-to-your-OData-metadata-or-service-path>\n```\nFor example, here is the base URL;\n```json\nhttps://mytrial-account.launchpad.cfapps.us10.hana.ondemand.com/dynamic_dest/mys4hc-destination/\n```\n\nAppend V2 Catalog to base URL;\n```\nhttps://mytrial-account.launchpad.cfapps.us10.hana.ondemand.com/dynamic_dest/mys4hc-destination/sap/opu/odata/IWFND/CATALOGSERVICE;v=2/ServiceCollection\n```\n\nAppend V4 Catalog to base URL;\n```\nhttps://mytrial-account.launchpad.cfapps.us10.hana.ondemand.com/dynamic_dest/mys4hc-destination/sap/opu/odata4/iwfnd/config/default/iwfnd/catalog/0002/ServiceGroups?$expand=DefaultSystem($expand=Services)\n```\n\nFor more information, please refer to this [site](https://ga.support.sap.com/dtp/viewer/index.html#/tree/3046/actions/45995:48363:53594:54336:51208)\n\n## Debugging Deployment Issues\n\n### Issue 1. Deployment fails with `The use of Gateway OData V2 Service Z_MY_SERVICE 0001 is not permitted`\n\n```bash\nerror abap-deploy-task YY1_Some_Service The use of Gateway OData V2 Service Z_MY_SERVICE 0001 is not permitted.\n```\n\nRefer to this [link](https://userapps.support.sap.com/sap/support/knowledge/en/3373955) for more information on how to resolve this issue.\n\nThe issue is caused by the custom UI5 Application having the ABAP Language Version \"ABAP for Cloud Development\" and therefore cannot be deployed to a system with ABAP Language Version \"ABAP for Key Users\".\n\n### Issue 2. Deployment fails with HTTP 403\n\n```bash\ninfo abap-deploy-task YY1_Some_App Creating archive with UI5 build result.\ninfo abap-deploy-task YY1_Some_App Archive created.\ninfo abap-deploy-task YY1_Some_App Starting to deploy.\ninfo abap-deploy-task YY1_Some_App YY1_Some_Service found on target system: false\nerror abap-deploy-task YY1_Some_App Request failed with status code 403\n```\n\nFor an HTTP 403 error, you can check the `Display Connectivity Trace` as an S/4HANA Administrator to see why the request is failing. In most cases its related two configuration issues;\n1. Your SAP BTP destination, defined in your `SAP BTP subaccount`, is not configured with SAMLAssertion. Deloyment is only supported using SAMLAssertion, a destination created with any other Autentication type will fail.\n2. The user logged into SAP Business Application Studio does not have the required `Business Role` assigned to allow the user to deploy the application. The user must have the `SAP_CORE_BC_EXT_UI` or `SAP_A4C_BC_DEV_UID_PC` role assigned to allow the user to deploy the application.\n\n### Issue 3. Deployment fails with HTTP 400\n\n```bash\nerror The app uses not permitted services for ABAP for Cloud Development\nerror abap-deploy-task ZF_TEST_API Request failed with status code 400\nerror abap-deploy-task ZF_TEST_API The use of Gateway OData V2 Service API_PROC_ORDER_CONFIRMATION_2_SRV 0001 is not permitted\n```\n\nPlease refer to the [Tenant Types](./README.md#tenant-types), as each tenant type has a different set of OData services that are allowed to be used or consumed.\n\nPlease refer to this [Q&A](https://userapps.support.sap.com/sap/support/knowledge/en/3445942) for more information on how to resolve this issue.\n\n### Issue 4. Calling OData V2 or V4 Catalogs does not include specific OData services\n\nWhen calling either of the OData V2 or V4 Catalogs, you might encounter an issue where specific OData services are not included in the response. This can happen if the user does not have the required authorizations or if the service is not available in the catalog.\n\nExample of calling the OData V2 and V4 Catalogs;\n```bash\n#V2 Catalog\n/sap/opu/odata/IWFND/CATALOGSERVICE;v=2/ServiceCollection\n#V4 Catalog\n/sap/opu/odata4/iwfnd/config/default/iwfnd/catalog/0002/ServiceGroups?$expand=DefaultSystem($expand=Services)\n```\n\nA list of standard OData services, typically available in the [V2 and V4 catalogs](https://api.sap.com/). If your OData service is not listed, then your V2 and/or V4 catalogs are limited in scope to custom services only. Refer to [Authorization Requirements](./README.md#authorization-requirements) to ensure your user has the required authorizations to access the standard OData services.\n\n### Issue 5. Support Communication Users\nIn some instances, you might need to create a support communication user to allow SAP Support to access your S/4HANA Cloud system. This is typically required for troubleshooting and debugging purposes.\nHowever, if you want the user to access the OData V2 or V4 catalogs, you need to ensure that the user has the required authorizations and roles assigned but you will also needd to change how the SAP BTP destination is configured.\n\nFor these purposes, its best you clone your existing SAP BTP destination, and change the type to a partial URL destination. This allows you to specify the `Service URL` as the base URL for the OData V2 or V4 catalog, and then append the specific service path to the destination URL.\n\nFor more information on configuring a partial URL destination, refer to this [link](https://ga.support.sap.com/dtp/viewer/index.html#/tree/3046/actions/45995:48363:53594:52803).\n\n### Issue 6. Standard OData services not showing in RecommendedServiceCollection\n\nPlease refer to this guide [./RecommendServices.md](./RecommendServices.md) for more information on how to troubleshoot this issue.\n\n## Related Links\nIntegrating SAP Business Application Studio -\n[https://help.sap.com/docs/SAP_S4HANA_CLOUD/0f69f8fb28ac4bf48d2b57b9637e81fa/22bc724fd51a4aa4a4d1c5854db7e026.html](https://help.sap.com/docs/SAP_S4HANA_CLOUD/0f69f8fb28ac4bf48d2b57b9637e81fa/22bc724fd51a4aa4a4d1c5854db7e026.html)\n\nDevelop a Custom UI for an SAP S/4HANA Cloud System - [https://developers.sap.com/tutorials/abap-custom-ui-bas-develop-s4hc.html\n](https://developers.sap.com/tutorials/abap-custom-ui-bas-develop-s4hc.html)\n\nCreate a SAP Fiori App and Deploy it to SAP S/4HANA Cloud, ABAP Environment - [https://developers.sap.com/tutorials/abap-s4hanacloud-procurement-purchasereq-shop-ui.html](https://developers.sap.com/tutorials/abap-s4hanacloud-procurement-purchasereq-shop-ui.html)\n\nSet Up Trust Between SAP Cloud Identity Services and SAP BTP, Cloud Foundry environment - [https://developers.sap.com/tutorials/abap-custom-ui-trust-cf.html](https://developers.sap.com/tutorials/abap-custom-ui-trust-cf.html)\n- Required when adding another trust configuration that is using a different identity provider. For example, where you are adding an IAS provider to manage your user profiles.\n- The trust protocol defined in your new IdP must be `SAML` to ensure the `SAMLAssertion` configuration in your SAP BTP destination works when connecting to your S4HC instance using `SAMLAssertion`.\n\nUser Management in a Nutshell (IAS or IDP) - [https://community.sap.com/t5/enterprise-resource-planning-blogs-by-sap/user-management-in-a-nutshell-for-the-sap-s-4hana-cloud-public-edition/ba-p/13556782](https://community.sap.com/t5/enterprise-resource-planning-blogs-by-sap/user-management-in-a-nutshell-for-the-sap-s-4hana-cloud-public-edition/ba-p/13556782)\n\n### License\nCopyright (c) 2009-2025 SAP SE or an SAP affiliate company. This project is licensed under the Apache Software License, version 2.0 except as noted otherwise in the [LICENSE](../../LICENSES/Apache-2.0.txt) file.\n\n\n",
  "excerpt": "SAMLAssertion destination configured to point SAP S/4HANA Cloud Public tenant Prerequisites 1. You have completed Step 2 and Step 3 https://developers.sap.com/tutorials/abap-custom-ui-bas-connect-s4hc...",
  "wordCount": 2113,
  "version": "1.0.0",
  "source": "fiori-samples",
  "sourceType": "github"
}