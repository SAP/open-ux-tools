{
  "id": "fiori-samples-cap-cap-fiori-mta-challenge2-md",
  "title": "Add Authentication to Catalog API using XSUAA",
  "category": "fiori-samples",
  "path": "cap/cap-fiori-mta/challenge2.md",
  "lastModified": "2025-09-29T10:06:39.518Z",
  "tags": [
    "fiori-samples",
    "md",
    "challenge2"
  ],
  "headers": [
    "Add Authentication to Catalog API using XSUAA"
  ],
  "content": "## Add Authentication to Catalog API using XSUAA\n- Update the `authenticationType` from `none` to `xsuaa`in `app->feproject-ui->xs-app.json`, as shown;\n```json\n    {\n      \"authenticationType\": \"xsuaa\",\n      \"csrfProtection\": false,\n      \"source\": \"^/catalog/\",\n      \"destination\": \"cap-catalog-api\"\n    },\n```\n- Add the following `dependencies` in the root `package.json`\n```json\n        \"@sap/xsenv\": \"^4.2.0\",\n        \"@sap/xssec\": \"^3.6.0\",\n        \"passport\": \"^0.6.0\"\n```\n- Enable authentication on the service catalog, add `@requires: 'authenticated-user'` to `srv->cat-service.cds`, as shown;\n```cds\n@requires: 'authenticated-user'\nservice CatalogService {\n    @readonly entity Books as projection on my.Books;\n}\n```\n\nThere are a number of MTA changes required to support xsuaa, open `mta.yaml` and make the following changes;\n- Change 1 - Add `appname` to the `parameters` node, this can be something unique to your subaccount, as shown;\n```yaml\nparameters:\n  deploy_mode: html5-repo\n  enable-parallel-deployments: true\n  appname: mycapproject-unique\n```\n- Change 2 - update the `managedAppCAPProject-srv` module to support authentication by adding `uaa_managedAppCAPProject` and removing the reference to `srv-api` by switching to the static URL using `host`, as shown;\n```yaml\n- name: managedAppCAPProject-srv\n  type: nodejs\n  path: gen/srv\n  requires:\n  - name: managedAppCAPProject-db\n  - name: uaa_managedAppCAPProject\n  parameters:\n    buildpack: nodejs_buildpack\n    host: ${appname}\n  build-parameters:\n    builder: npm-ci\n    ignore: [\".env\", \"node_modules/\"]\n ```\n- Change 3 - Update the catalog API endpoint exposed in the `managedAppCAPProject-destination-service` resource, update `URL` path to `https://${appname}.${default-domain}` which will now be referenced by a static hostname, generated in change 1;\n```yaml\n  - Authentication: NoAuthentication\n    Name: cap-catalog-api\n    ProxyType: Internet\n    Type: HTTP\n    URL: https://${appname}.${default-domain}\n    HTML5.DynamicDestination: true\n    HTML5.ForwardAuthToken: true    \n```\n- Change 4 - Remove the `srv-api` reference in the  `managedAppCAPProject-destination-service` resource, this service API is no longer applicable since we are using a static host now\n- Once everything is validated as working, re-run the build and deploy steps to push your changes to CF\n- Your Catalog API is now secured with XSUAA authentication",
  "excerpt": "Add Authentication to Catalog API using XSUAA - Update the authenticationType from none to xsuaain app->feproject-ui->xs-app.json, as shown; `json     {       \"authenticationType\": \"xsuaa\",       \"csr...",
  "wordCount": 286,
  "version": "1.0.0",
  "source": "fiori-samples",
  "sourceType": "github"
}