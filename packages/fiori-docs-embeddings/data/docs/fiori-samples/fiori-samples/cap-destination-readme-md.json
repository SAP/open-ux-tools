{
  "id": "fiori-samples-cap-destination-readme-md",
  "title": "Expose a deployed CAP project as an SAP BTP destination",
  "category": "fiori-samples",
  "path": "cap/destination/README.md",
  "lastModified": "2025-09-29T10:06:39.520Z",
  "tags": [
    "fiori-samples",
    "md",
    "README"
  ],
  "headers": [
    "Expose a deployed CAP project as an SAP BTP destination",
    "Prerequisites",
    "Description",
    "Want to Go Cross-Subaccount and Regions?",
    "License"
  ],
  "content": "# Expose a deployed CAP project as an SAP BTP destination\n\n\n## Prerequisites\n\n- You have an SAP BTP account, for example a [trial account](https://account.hana.ondemand.com/)\n- You are subscribed to the SAP Build Work Zone, follow this [tutorial](https://developers.sap.com/tutorials/cp-portal-cloud-foundry-getting-started.html) for more information\n- You have deployed a CAP project with a SAPUI5 Fiori UI using this [blog post](https://community.sap.com/t5/technology-blogs-by-sap/build-and-deploy-a-cap-project-node-js-api-with-a-sap-fiori-elements-ui-and/ba-p/13537906)\n- You are exposing the SAP BTP destination from the same subaccount where the CAP project is deployed\n\n## Description\n\nFor more information about destinations, see this [blog post](https://community.sap.com/t5/technology-blogs-by-members/sap-btp-destinations-in-a-nutshell-part-3-oauth-2-0-client-credentials/ba-p/13577101).\n\nStep 1: Access your `nodejs` service, selecting your dev space, which will list all the running services on your space;\n\n[![Alt text](Step1.png \"CAP project service\")](Step1.png)\n\nStep 2:  Select the `nodejs` service which will expose the CAP endpoint.\n\n[![Alt text](Step2.png \"CAP Project Endpoint\")](Step2.png)\n\nIn this case, the endpoint is;\n\nhttps://28bdb0fbtrial-dev-managedappcapproject-srv.cfapps.us10-001.hana.ondemand.com\n\n[![Alt text](Step2b.png \"Catalog of Services\")](Step2b.png)\n\nWhen you select any of the exposed services, for example; \n\n```\nhttps://28bdb0fbtrial-dev-managedappcapproject-srv.cfapps.us10-001.hana.ondemand.com/odata/v4/catalog\n```\n\nyou will receive a `HTTP 401 unauthorized error` since you aren't passing the appropriate headers to the application otherwise your application would be exposed to the internet with no security;\n\n[![Alt text](Step2c.png \"401 Error\")](Step2c.png)\n\nStep 3: Access your Security XSUAA credentials\n\nNavigate back to the root of your subaccount and select `Instances and Subscriptions`.\n\n[![Alt text](Step3.png \"Instances and Subscriptions\")](Step3.png)\n\nStep 4: Select the `Authorization and Trust Management Service` service instance that was deployed with your CAP project. In this example: `managedAppCAPProject-xsuaa-service`.\n\n[![Alt text](Step4.png \"XSUAA Service Instance\")](Step4.png)\n\nStep 5: Select the `Service Keys` tab. If a key doesn't exist, create a new service key.\n\n[![Alt text](Step5.png \"XSUAA Service Key\")](Step4.png)\n\nIn the service key, you will need the following properties;\n\n- clientid\n- clientsecret\n- url\n\nFor example;\n```\nsb-managedappcapproject!t299668\nxGRgYPoAXbMv2gqRIDontThinkSooZ7uY=\nhttps://28bdb0fbtrial.authentication.us10.hana.ondemand.com\n```\n\nStep 6: Create a new destination in your SAP BTP account, navigate to the `Connectivity` service and select `Destinations` and `Create destination` and change the `Authentication` type to `OAuth2ClientCredentials`.\n\n```json\nName: capdestination\nDescription: CAP Project Destination\nURL: from step 2 i.e. https://28bdb0fbtrial-dev-managedappcapproject-srv.cfapps.us10-001.hana.ondemand.com\nClient ID: from step 5 i.e. sb-managedappcapproject!t299668\nClient Secret: from step 5 i.e. xGRgYPoAXbMv2gqRIDontThinkSooZ7uY=\nToken Service URL: from step 5 i.e. https://28bdb0fbtrial.authentication.us10.hana.ondemand.com appended with /oauth/token\nToken Service user: same as client ID\nToken Service password: same as client secret\nHTML5.Timeout: 60000\nWebIDEEnabled: true\nWebIDEUsage: odata_gen\nHTML5.DynamicDestination: true\nHTML5.Timeout: 60000\nAuthentication: OAuth2ClientCredentials\n```\n\nPlease note, you need to append `/oauth/token` to the `Token Service URL` property.\n\nSave the destination and you should see the following;\n\n[![Alt text](Step6.png \"New Destination\")](Step6.png)\n\nUsing a SAP BTP destination with `OAuth2ClientCredentials` is typically used to authenticate a service or application (Client Credentials Grant) rather than a user. To switch to using a Token Exchange Grant, change the `Authentication` type to `OAuth2UserTokenExchange` which is typically used to authenticate a user across systems (Token Exchange Grant) which will remove the requirement to have a `Token User` and `Token Service Password` in the destination configuration.\n\nStep 7: Let's confirm everything works!\n\nLogin into Business Application Studio and select `Service Centre` on the left navigation bar;\n\n[![Alt text](Step7.png \"Service Centre\")](Step7.png)\n\nSelect the destination you created `capdestination` and it will show the status as `Not Available` since you need to append the service path;\n\nEnter the path to the service you want to access i.e. `/odata/v4/catalog` and click `Connect`;\n\n[![Alt text](Step7b.png \"Service Centre\")](Step7b.png)\n\nAnother way to test the destination is to use `curl` from a terminal window;\n\n```bash\ncurl -L \"https://capdestination.dest/odata/v4/catalog\" -vs > curl-cap-output.txt 2>&1\n```\n\nThis will generate a file called `curl-cap-output.txt` with the output of the request; you should see the OData being returned;\n\n```JSON\n{\n  \"@odata.context\": \"$metadata\",\n  \"@odata.metadataEtag\": \"W/\\\"kpKGEWiUkdl2tvln8+lIbb+WgNsbQRujr+H11i5pAUg=\\\"\",\n  \"value\": [\n    {\n      \"name\": \"Books\",\n      \"url\": \"Books\"\n    }\n  ]\n}\n\n```\n\nYou can now use the SAP Fiori tools generator to start generating HTML5 applications that consume the OData services from your CAP project services.\n\n## Want to Go Cross-Subaccount and Regions?\n\nSee [SAP BTP: How to call protected app across regions with SAML and OAuth](https://community.sap.com/t5/technology-blogs-by-sap/sap-btp-how-to-call-protected-app-across-regions-with-saml-and-oauth-2/ba-p/13546145).\n\n### License\nCopyright (c) 2009-2025 SAP SE or an SAP affiliate company. This project is licensed under the Apache Software License, version 2.0 except as noted otherwise in the [LICENSE](../../LICENSES/Apache-2.0.txt) file.\n\n",
  "excerpt": "Expose a deployed CAP project as an SAP BTP destination Prerequisites - You have an SAP BTP account, for example a trial account - You are subscribed to the SAP Build Work Zone, follow this tutorial f...",
  "wordCount": 675,
  "version": "1.0.0",
  "source": "fiori-samples",
  "sourceType": "github"
}