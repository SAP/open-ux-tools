{
  "id": "fiori-samples-app-with-tutorials-non-cap-sapui5-basic-manage-products-webapp-utils-locate-reuse-libs-js",
  "title": "locate reuse libs",
  "category": "fiori-samples",
  "path": "app-with-tutorials/non-cap/sapui5/basic/manage-products/webapp/utils/locate-reuse-libs.js",
  "lastModified": "2025-09-29T10:06:39.514Z",
  "tags": [
    "fiori-samples",
    "js",
    "locate",
    "reuse",
    "libs"
  ],
  "headers": [],
  "content": "# locate-reuse-libs.js\n\n```javascript\n/*eslint-disable semi, no-console*/\n(function (sap) {\n    var getKeys = function (libOrComp, libOrCompKeysString) {\n        // SAPUI5 delivered namespaces from https://ui5.sap.com/#/api/sap\n        var ui5Libs = [\n            \"sap.apf\",\n            \"sap.base\",\n            \"sap.chart\",\n            \"sap.collaboration\",\n            \"sap.f\",\n            \"sap.fe\",\n            \"sap.fileviewer\",\n            \"sap.gantt\",\n            \"sap.landvisz\",\n            \"sap.m\",\n            \"sap.ndc\",\n            \"sap.ovp\",\n            \"sap.rules\",\n            \"sap.suite\",\n            \"sap.tnt\",\n            \"sap.ui\",\n            \"sap.uiext\",\n            \"sap.ushell\",\n            \"sap.uxap\",\n            \"sap.viz\",\n            \"sap.webanalytics\",\n            \"sap.zen\"\n        ];\n        Object.keys(libOrComp).forEach(function (libOrCompKey) {\n            // ignore libs or Components that start with SAPUI5 delivered namespaces\n            if (\n                !ui5Libs.some(function (substring) {\n                    return libOrCompKey === substring || libOrCompKey.startsWith(substring + \".\");\n                })\n            ) {\n                if (libOrCompKeysString.length > 0) {\n                    libOrCompKeysString = libOrCompKeysString + \",\" + libOrCompKey;\n                } else {\n                    libOrCompKeysString = libOrCompKey;\n                }\n            }\n        });\n        return libOrCompKeysString;\n    };\n\n    var updateManifest = function (manifest) {\n        var result = \"\";\n        if (manifest) {\n            if (manifest[\"sap.ui5\"] && manifest[\"sap.ui5\"].dependencies) {\n                if (manifest[\"sap.ui5\"].dependencies.libs) {\n                    result = getKeys(manifest[\"sap.ui5\"].dependencies.libs, result);\n                }\n                if (manifest[\"sap.ui5\"].dependencies.components) {\n                    result = getKeys(manifest[\"sap.ui5\"].dependencies.components, result);\n                }\n            }\n            if (manifest[\"sap.ui5\"] && manifest[\"sap.ui5\"].componentUsages) {\n                result = getKeys(manifest[\"sap.ui5\"].componentUsages, result);\n            }\n        }\n        return result;\n    };\n\n    var fioriToolsGetManifestLibs = function (manifestPath) {\n        var url = manifestPath;\n        return new Promise(function (resolve, reject) {\n            $.ajax(url)\n                .done(function (manifest) {\n                    resolve(updateManifest(manifest));\n                })\n                .fail(function () {\n                    reject(new Error(\"Could not fetch manifest at '\" + manifestPath));\n                });\n        });\n    };\n\n    var updateModuleDefinition = function (data) {\n        if (data) {\n            Object.keys(data).forEach(function (moduleDefinitionKey) {\n                var moduleDefinition = data[moduleDefinitionKey];\n                if (moduleDefinition && moduleDefinition.dependencies) {\n                    moduleDefinition.dependencies.forEach(function (dependency) {\n                        if (dependency.url && dependency.url.length > 0 && dependency.type === \"UI5LIB\") {\n                            jQuery.sap.log.info(\n                                \"Registering Library \" + dependency.componentId + \" from server \" + dependency.url\n                            );\n                            jQuery.sap.registerModulePath(dependency.componentId, dependency.url);\n                        }\n                    });\n                }\n            });\n        }\n    };\n\n    /**\n     * Registers the module paths for dependencies of the given component.\n     * @param {string} manifestPath The the path to the app manifest path\n     * for which the dependencies should be registered.\n     * @returns {Promise} A promise which is resolved when the ajax request for\n     * the app-index was successful and the module paths were registered.\n     */\n    sap.registerComponentDependencyPaths = function (manifestPath) {\n        /*eslint-disable semi, consistent-return*/\n        return fioriToolsGetManifestLibs(manifestPath).then(function (libs) {\n            if (libs && libs.length > 0) {\n                var url = \"/sap/bc/ui2/app_index/ui5_app_info?id=\" + libs;\n                var sapClient = jQuery.sap.getUriParameters().get(\"sap-client\");\n                if (sapClient && sapClient.length === 3) {\n                    url = url + \"&sap-client=\" + sapClient;\n                }\n                return $.ajax(url).done(updateModuleDefinition);\n            }\n        });\n    };\n})(sap);\n\n/*eslint-disable sap-browser-api-warning, sap-no-dom-access*/\nvar scripts = document.getElementsByTagName(\"script\");\nvar currentScript = document.getElementById(\"locate-reuse-libs\");\nif (!currentScript) {\n    currentScript = document.currentScript;\n}\nvar manifestUri = currentScript.getAttribute(\"data-sap-ui-manifest-uri\");\nvar componentName = currentScript.getAttribute(\"data-sap-ui-componentName\");\nvar useMockserver = currentScript.getAttribute(\"data-sap-ui-use-mockserver\");\nvar bundleResources = function () {\n    jQuery.sap.require(\"jquery.sap.resources\");\n    var sLocale = sap.ui.getCore().getConfiguration().getLanguage();\n    var oBundle = jQuery.sap.resources({\n        url: \"i18n/i18n.properties\",\n        locale: sLocale\n    });\n    document.title = oBundle.getText(\"appTitle\");\n};\nsap.registerComponentDependencyPaths(manifestUri)\n    .catch(function (error) {\n        jQuery.sap.log.error(error);\n    })\n    .finally(function () {\n        // setting the app title with internationalization\n        sap.ui.getCore().attachInit(bundleResources);\n\n        if (componentName && componentName.length > 0) {\n            if (useMockserver && useMockserver === \"true\") {\n                sap.ui.getCore().attachInit(function () {\n                    sap.ui.require([componentName.replace(/\\./g, \"/\") + \"/localService/mockserver\"], function (server) {\n                        // set up test service for local testing\n                        server.init();\n                        // initialize the ushell sandbox component\n                        sap.ushell.Container.createRenderer().placeAt(\"content\");\n                    });\n                });\n            } else {\n                // Requiring the ComponentSupport module automatically executes the component initialisation for all declaratively defined components\n                sap.ui.require([\"sap/ui/core/ComponentSupport\"]);\n\n                // setting the app title with the i18n text\n                sap.ui.getCore().attachInit(bundleResources);\n            }\n        } else {\n            sap.ui.getCore().attachInit(function () {\n                // initialize the ushell sandbox component\n                sap.ushell.Container.createRenderer().placeAt(\"content\");\n            });\n        }\n    });\n\nsap.registerComponentDependencyPaths(manifestUri);\n\n```",
  "excerpt": "locate-reuse-libs.js",
  "wordCount": 514,
  "version": "1.0.0",
  "source": "fiori-samples",
  "sourceType": "github"
}