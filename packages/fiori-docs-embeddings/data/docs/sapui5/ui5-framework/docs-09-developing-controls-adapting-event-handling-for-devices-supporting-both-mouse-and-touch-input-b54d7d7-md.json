{
  "id": "sapui5-docs-09-developing-controls-adapting-event-handling-for-devices-supporting-both-mouse-and-touch-input-b54d7d7-md",
  "title": "Adapting Event Handling for Devices Supporting both Mouse and Touch Input",
  "category": "ui5-framework",
  "path": "docs/09_Developing_Controls/adapting-event-handling-for-devices-supporting-both-mouse-and-touch-input-b54d7d7.md",
  "lastModified": "2025-09-01T18:17:10.672Z",
  "tags": [
    "ui5-framework",
    "md",
    "Adapting",
    "Event",
    "Handling",
    "for",
    "Devices",
    "Supporting",
    "both",
    "Mouse",
    "and",
    "Touch",
    "Input"
  ],
  "headers": [
    "Adapting Event Handling for Devices Supporting both Mouse and Touch Input",
    "Context",
    "Procedure",
    "Example"
  ],
  "content": "<!-- loiob54d7d73eff245d3ab91b96e21177ebf -->\n\n# Adapting Event Handling for Devices Supporting both Mouse and Touch Input\n\nSAPUI5 event delegation automatically handles both mouse and touch events simultaneously. If you are using jQuery or native browser API \\(`domElement.addEventListener`\\) to handle events, you have to adapt your coding to support both.\n\n\n\n## Context\n\nTo prevent the event handler from being called twice for each touch event, additional emulated mouse events shouldn't be handled. This can be achieved by checking the `_sapui_delayedMouseEvent` flag that we set on these emulated mouse events. We have extended the `jQuery.Event` object with an `isMarked` function for checking UI5-specific flags on the real event object. The `sapui` prefix is already considered within the `isMarked` function, so only the semantic part needs to be passed into the function \\(for example, for checking if the `_sapui_delayedMouseEvent` flag is marked, simply call `isMarked(delayedMouseEvent)`\\). However, when event handler is bound using a browser API like `addEventListener`, the flag needs to be checked using the full flag name, since there is no `isMarked` function on the browser event object.\n\nIn most cases, the event handler was previously bound by checking if touch is supported, like shown below:\n\n```js\n// \"Device\" required from module \"sap/ui/Device\"\njQuery(document).on(Device.support.touch ? \"touchmove\" : \"mousemove\", function(oEvent) {\n    ......\n});\n```\n\n\n\n## Procedure\n\n1.  Since both mouse and touch should now be supported, the code needs to be changed as follows:\n\n    -   When using jQuery:\n\n        ```js\n        \n        jQuery(document).on(\"touchmove mousemove\", function(oEvent) {\n            if (oEvent.isMarked(\"delayedMouseEvent\")) {\n        \n                // Suppress the emulated mouse event from the touch interface\n                return;\n            }\n            ......\n        });\n        ```\n\n    -   When using native browser event listeners:\n\n        ```js\n        \n        var fnHandler = function (oEvent ) { if (oEvent . _sapui_delayedMouseEvent ) { // Suppress the emulated mouse event from the touch interface\n         return ; } ...... };\n        \n        document . addEventListener ( \"touchmove\" , fnHandler );\n        document . addEventListener ( \"mousemove\" , fnHandler );\n        ```\n\n\n2.  The same procedure should be applied for the all touch and mouse event pairs when these events are needed:\n\n    -   `touchstart` and `mousedown`\n    -   `touchmove` and `mousemove`\n    -   `touchend`, `touchcancel` and `mouseup`\n\n\n\n\n## Example\n\nWe have also adapted some controls within `sap.m` for devices supporting both mouse and touch input. Let's take `sap/m/RatingIndicator` as an example, where the user can drag a rating indicator to change a rating value. This is implemented by registering a `touchmove` or `mousemove` event in the `ontouchstart` function, and `deregister` from `touchmove` or `mousemove`by listening to `touchend`, `touchcancel` or `mouseup`.\n\n**Code before the adaptation:**\n\n```js\n// \"RatingIndicator\" defined in module \"sap/m/RatingIndicator\"\n// \"Device\" required from module \"sap/ui/Device\"\nRatingIndicator.prototype.ontouchstart = function(oEvent) {\n    if (this.getEnabled()) {\n        ......\n\n        if (!this._touchEndProxy) {\n            this._touchEndProxy = jQuery.proxy(this._ontouchend, this);\n        }\n\n        if (!this._touchMoveProxy) {\n            this._touchMoveProxy = jQuery.proxy(this._ontouchmove, this);\n        }\n\n        // here also bound to the mouseup mousemove event to enable it working in\n        // desktop browsers\n        if (Device.support.touch) {\n            jQuery(window.document).on(\"touchend touchcancel\", this._touchEndProxy);\n            jQuery(window.document).on(\"touchmove\", this._touchMoveProxy);\n        } else {\n            jQuery(window.document).on(\"mouseup\", this._touchEndProxy);\n            jQuery(window.document).on(\"mousemove\", this._touchMoveProxy);\n        }\n\n        ......\n    }\n};\n\nRatingIndicator.prototype._ontouchmove = function(oEvent) {\n    ......\n};\n\nRatingIndicator.prototype._ontouchend = function(oEvent) {\n    if (this.getEnabled()) {\n        ......\n        if (Device.support.touch) {\n            jQuery(window.document).off(\"touchend touchcancel\", this._touchEndProxy);\n            jQuery(window.document).off(\"touchmove\", this._touchMoveProxy);\n        } else {\n            jQuery(window.document).off(\"mouseup\", this._touchEndProxy);\n            jQuery(window.document).off(\"mousemove\", this._touchMoveProxy);\n        }\n        ......\n    }\n};\n```\n\n**Code after adaptation:**\n\n```js\n// \"RatingIndicator\" defined in module \"sap/m/RatingIndicator\"\n// \"Device\" required from module \"sap/ui/Device\"\nRatingIndicator.prototype.ontouchstart = function (oEvent) {\n    if (this.getEnabled()) {\n        ......\n\n        if (!this._touchEndProxy) {\n            this._touchEndProxy = jQuery.proxy(this._ontouchend, this);\n        }\n        if (!this._touchMoveProxy) {\n            this._touchMoveProxy = jQuery.proxy(this._ontouchmove, this);\n        }\n\n        // The if (Device.support.touch) is removed and both mouse and touch events are supported always\n        jQuery(window.document).on(\"touchend touchcancel mouseup\", this._touchEndProxy);\n        jQuery(window.document).on(\"touchmove mousemove\", this._touchMoveProxy);\n\n        ......\n    }\n};\n\nRatingIndicator.prototype._ontouchmove = function (oEvent) {\n    // Check the _sapui_delayedMouseEvent flag for the emulated mouse event from the touch interface\n    if (oEvent.isMarked(\"delayedMouseEvent\")) {\n        return;\n    }\n    ......\n};\n\nRatingIndicator.prototype._ontouchend = function (oEvent) {\n    // Check the _sapui_delayedMouseEvent flag for the emulated mouse event from the touch interface\n    if (oEvent.isMarked(\"delayedMouseEvent\")) {\n        return;\n    }\n    \n    if (this.getEnabled()) {\n        ......\n\n        // The if (Device.support.touch) is removed, just deregister from every event\n        jQuery(window.document).off(\"touchend touchcancel mouseup\", this._touchEndProxy);\n        jQuery(window.document).off(\"touchmove mousemove\", this._touchMoveProxy);\n\n        ......\n    }\n};\n```\n\n",
  "excerpt": "<!-- loiob54d7d73eff245d3ab91b96e21177ebf --> Adapting Event Handling for Devices Supporting both Mouse and Touch Input SAPUI5 event delegation automatically handles both mouse and touch events simult...",
  "wordCount": 660,
  "version": "1.0.0",
  "source": "sapui5",
  "sourceType": "github"
}