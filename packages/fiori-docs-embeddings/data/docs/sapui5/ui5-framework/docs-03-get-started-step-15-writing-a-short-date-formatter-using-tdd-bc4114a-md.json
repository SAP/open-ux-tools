{
  "id": "sapui5-docs-03-get-started-step-15-writing-a-short-date-formatter-using-tdd-bc4114a-md",
  "title": "Step 15: Writing a Short Date Formatter Using TDD",
  "category": "ui5-framework",
  "path": "docs/03_Get-Started/step-15-writing-a-short-date-formatter-using-tdd-bc4114a.md",
  "lastModified": "2025-09-01T18:17:10.455Z",
  "tags": [
    "ui5-framework",
    "md",
    "Step",
    "Writing",
    "Short",
    "Date",
    "Formatter",
    "Using",
    "TDD"
  ],
  "headers": [
    "Step 15: Writing a Short Date Formatter Using TDD",
    "Preview",
    "Coding",
    "webapp/test/unit/unitTests.qunit.js",
    "webapp/model/DateFormatter.js \\(New\\)",
    "webapp/test/unit/model/DateFormatter.js \\(New\\)",
    "webapp/test/unit/model/DateFormatter.js",
    "webapp/model/DateFormatter.js",
    "Dependency Injection:",
    "webapp/test/unit/model/DateFormatter.js",
    "webapp/model/DateFormatter.js",
    "Refactoring:",
    "webapp/test/unit/model/DateFormatter.js",
    "Dependency Injection to Get Independent from System Time:",
    "webapp/test/unit/model/DateFormatter.js",
    "webapp/model/DateFormatter.js",
    "Boundary Testing:",
    "webapp/test/unit/model/DateFormatter.js",
    "webapp/model/DateFormatter.js",
    "webapp/test/unit/model/DateFormatter.js",
    "webapp/model/DateFormatter.js"
  ],
  "content": "<!-- loiobc4114a88e4d4ac1a0f53b2a7a92b226 -->\n\n# Step 15: Writing a Short Date Formatter Using TDD\n\nIt's now time to improve the content of the *Info* tab. We want to see the *Posted At* date in a formatted way. Based on the age of the post, we either display the time, a textural representation of the day, or the date only.\n\n\n\n## Preview\n\n  \n  \n**Unit tests of the formatter**\n\n![](images/Tutorial_Testing_Step_15_1_8ab2798.png \"Unit tests of the formatter\")\n\nDepending on the current date, we distinguish four different formatting categories, as shown in the table below:\n\n**Formatting Categories**\n\n\n<table>\n<tr>\n<th valign=\"top\">\n\nCategory\n\n</th>\n<th valign=\"top\">\n\nSample Input\n\n</th>\n<th valign=\"top\">\n\nExpected Output \\(for `en-US`\\)\n\n</th>\n</tr>\n<tr>\n<td valign=\"top\">\n\nToday\n\n</td>\n<td valign=\"top\">\n\n`2013/02/13 12:05:20` \n\n</td>\n<td valign=\"top\">\n\n***12:05 PM*** \n\n</td>\n</tr>\n<tr>\n<td valign=\"top\">\n\nYesterday\n\n</td>\n<td valign=\"top\">\n\n`2013/02/12 12:05:20` \n\n</td>\n<td valign=\"top\">\n\n***Yesterday*** \n\n</td>\n</tr>\n<tr>\n<td valign=\"top\">\n\nLast 7 days\n\n</td>\n<td valign=\"top\">\n\n`2013/02/08 12:05:20` \n\n</td>\n<td valign=\"top\">\n\n***Friday*** \n\n</td>\n</tr>\n<tr>\n<td valign=\"top\">\n\nOthers\n\n</td>\n<td valign=\"top\">\n\n`2011/02/05 12:05:20` \n\n</td>\n<td valign=\"top\">\n\n***Dec 5, 2011*** \n\n</td>\n</tr>\n</table>\n\nAs you can see, we have many different cases, and our formatter contains real logic.\n\nWe test this in a unit test. In this step we will follow an iterative approach. We first write a failing test and immediately fix it by adding the production code to make the test pass. Then the next iteration starts. We do not write more than one failing unit test at once.\n\n> ### Note:  \n> There are many benefits of consequently applying the test-driven development \\(TDD\\) methodology, for example, very fast feedback, you can execute your tests after each change and get immediate feedback if the tests run green. You also spend less time debugging and for analysis. We recommend that you get familiar with TDD and clean code practices. In this step you get a first impression how TDD results in better separation of concerns, APIs, handling of dependencies, code reuse, and a test suite growing together with the code.\n\n\n\n## Coding\n\nYou can view and download all files in the *Samples* in the Demo Kit at [Testing - Step 15](https://ui5.sap.com/#/entity/sap.m.tutorial.testing/sample/sap.m.tutorial.testing.15).\n\n\n\n## webapp/test/unit/unitTests.qunit.js\n\n```js\nsap.ui.define([\n\t\"./model/models\",\n\t\"./model/formatter\",\n\t\"./model/FlaggedType\",\n\t\"./model/DateFormatter\"\n});\n```\n\nFirst, we add the new test file we are about to create to the `unitTests.qunit.js` file.\n\n\n\n## webapp/model/DateFormatter.js \\(New\\)\n\n```js\nsap.ui.define([\n\t\"sap/ui/base/Object\"\n], function(Object) {\n\t   return Object.extend(\"sap.ui.demo.bulletinboard.model.DateFormatter\", {\n\t   });\n});\n```\n\nWe create an empty hull for our formatter implementation first so that we can include it in our test. It does not contain any logic yet but simply extends an SAPUI5 base object.\n\n\n\n## webapp/test/unit/model/DateFormatter.js \\(New\\)\n\n```js\nsap.ui.define([\n\t\"sap/ui/demo/bulletinboard/model/DateFormatter\"\n], function(DateFormatter) {\n\tQUnit.module(\"DateFormatter\");\n\n\tQUnit.test(\"initial\", function(assert) {\n\t\tassert.ok(new DateFormatter());\n\t});\n});\n```\n\nAnd we create our test that checks if there is a `DateFormatter` object. Now we can execute our unit tests. We see that this test is failing as the object does not exist in our code yet.\n\n\n\n## webapp/test/unit/model/DateFormatter.js\n\n```js\nsap.ui.define([\n\t\"sap/ui/demo/bulletinboard/model/DateFormatter\"\n], function(DateFormatter) {\n\tQUnit.module(\"DateFormatter\");\n\tQUnit.test(\"Should return empty string if no date is given\", function(assert) {\n\t\tvar oFormatter = new DateFormatter();\n\t\tvar sFormattedDate = oFormatter.format(null);\n\t\tassert.strictEqual(sFormattedDate, \"\");\n\t});\n});\n```\n\nNow we implement a test for the API of the format function. We assume it will have a `Date` object as input parameter. In the first step, the test verifies that the format function returns an empty string if we pass `null`.\n\n\n\n## webapp/model/DateFormatter.js\n\n```js\nsap.ui.define([\n\t\"sap/ui/base/Object\"\n], function(Object) {\n\t   return Object.extend(\"sap.ui.demo.bulletinboard.model.DateFormatter\", {\n  \tformat: function() {\n\t\t\t\t    return \"\";\n\t\t\t }\n\t   });\n});\n```\n\nNow we fix our test again by returning the expected string.\n\n\n\n<a name=\"loiobc4114a88e4d4ac1a0f53b2a7a92b226__section_bng_kpv_cdc\"/>\n\n## Dependency Injection:\n\n\n\n<a name=\"loiobc4114a88e4d4ac1a0f53b2a7a92b226__section_cng_kpv_cdc\"/>\n\n## webapp/test/unit/model/DateFormatter.js\n\n```js\nsap.ui.define([\n\t\"sap/ui/demo/bulletinboard/model/DateFormatter\",\n\t\"sap/ui/core/Locale\",\n\t\"sap/ui/core/date/UI5Date\"\n], function(DateFormatter, Locale, UI5Date) {\n\tQUnit.module(\"DateFormatter\");\n\tQUnit.test(\"Should return empty string if no date is given\", function(assert) {\n\t\tvar oFormatter = new DateFormatter({\n\t\t\tlocale : new Locale(\"en-US\")\n\t\t});\n\t\tvar sFormattedDate = oFormatter.format(null);\n\t\tassert.strictEqual(sFormattedDate, \"\");\n\t});\n\tQUnit.test(\"Should return time if date from today\", function(assert) {\n\t\tvar oFormatter = new DateFormatter({\n\t\t\tlocale : new Locale(\"en-US\")\n\t\t});\n\t\tvar oDate = UI5Date.getInstance(2015, 2, 14, 12, 5, 0, 0);\n\t\tvar sFormattedDate = oFormatter.format(oDate);\n\t\tassert.strictEqual(sFormattedDate, \"12:05 PM\");\n\t});\n});\n```\n\nHere our test expects that the date is displayed as time when the post is from today. If we rely on the browser language the test would be fragile. It will fail in some languages. To avoid this, we pass the locale settings to the formatter's constructor. The test will use a fixed locale `en-US` in order to remain stable. This mechanism is called **Dependency Injection**.\n\n\n\n## webapp/model/DateFormatter.js\n\n```js\nsap.ui.define([\n\t\"sap/ui/base/Object\",\n\t\"sap/ui/core/format/DateFormat\"\n], function(Object, DateFormat) {\n\treturn Object.extend(\"sap.ui.demo.bulletinboard.model.DateFormatter\", {\n\t\tconstructor: function(oProperties) {\n\t\t\tthis.timeFormat = DateFormat.getTimeInstance({\n\t\t\t\tstyle: \"short\"\n\t\t\t}, oProperties.locale);\n\t\t},\n\t\tformat: function(oDate) {\n\t\t\tif (!oDate) {\n\t\t\t\treturn \"\";\n\t\t\t}\n\t\t\treturn this.timeFormat.format(oDate);\n\t\t}\n\t});\n});\n```\n\nIn the implementation we use the `DateFormat` of SAPUI5 to create a short date. The locale is passed on to the `getTimeInstance` function.\n\n> ### Note:  \n> The implementation should not do more than the current tests covers. This makes sure you cover all the code paths. You can enable the code coverage by selecting the *Enable coverage* checkbox.\n> \n> ![](images/Tutorial_Testing_Step_15_2_a700487.png)\n> \n> It will show the lines covered by your tests \\(white\\) and the ones that were not covered \\(red\\). For the single test above the coverage looks like this. The red line is already covered by the previous test so in total we have a test coverage of 100%.\n\n\n\n<a name=\"loiobc4114a88e4d4ac1a0f53b2a7a92b226__section_kmk_m4v_cdc\"/>\n\n## Refactoring:\n\n\n\n<a name=\"loiobc4114a88e4d4ac1a0f53b2a7a92b226__section_lmk_m4v_cdc\"/>\n\n## webapp/test/unit/model/DateFormatter.js\n\n```js\nsap.ui.define([\n\t\"sap/ui/demo/bulletinboard/model/DateFormatter\",\n\t\"sap/ui/core/Locale\",\n\t\"sap/ui/core/date/UI5Date\"\n], function(DateFormatter, Locale, UI5Date) {\n\tvar oFormatter = null;\n\tQUnit.module(\"DateFormatter\", {\n\t\tbeforeEach: function() {\n\t\t\toFormatter = new DateFormatter({\n\t\t\t\tlocale: new Locale(\"en-US\")\n\t\t\t});\n\t\t}\n\t});\n\n\tQUnit.test(\"Should return empty string if no date is given\", function(assert) {\n\t\t// Delete in your code: var oFormatter = new DateFormatter();\n\t\t\t    // ...\n\t});\n\tQUnit.test(\"Should return time if date from today\", function(assert) {\n\t\t// Delete in your code: var oFormatter = new DateFormatter({\n\t\t// Delete in your code: \tlocale: new Locale(\"en-US\")\n\t\t// Delete in your code: });\n\t\t// ...\n\t});\n});\n```\n\nOur tests are running so we can start refactoring our code. Since we need the `DateFormatter` object in every test case we will move it to the QUnit module's `beforeEach` function. As the name suggests, the function is invoked before each test so we may use it to save some code we need in every test.\n\n\n\n<a name=\"loiobc4114a88e4d4ac1a0f53b2a7a92b226__section_k31_c4v_cdc\"/>\n\n## Dependency Injection to Get Independent from System Time:\n\n\n\n<a name=\"loiobc4114a88e4d4ac1a0f53b2a7a92b226__section_l31_c4v_cdc\"/>\n\n## webapp/test/unit/model/DateFormatter.js\n\n```js\nsap.ui.define([\n\t\"sap/ui/demo/bulletinboard/model/DateFormatter\",\n\t\"sap/ui/core/Locale\",\n\t\"sap/ui/core/date/UI5Date\"\n], function(DateFormatter, Locale, UI5Date) {\n\tvar oFormatter = null;\n\tQUnit.module(\"DateFormatter\", {\n\t\tbeforeEach: function() {\n\t\t\toFormatter = new DateFormatter({\n\t\t\t\tnow : function() {\n\t\t\t\t\treturn UI5Date.getInstance(2015, 2, 14, 14, 0, 0, 0).getTime();\n\t\t\t\t},\n\t\t\t\tlocale : new Locale(\"en-US\")\n\t\t\t});\n\t\t}\n\t});\n\t// ...\n\tQUnit.test(\"Should return 'Yesterday' if date from yesterday\", function(assert) {\n\t\tvar oDate = UI5Date.getInstance(2015, 2, 13);\n\t\tvar sFormattedDate = oFormatter.format(oDate);\n\t\tassert.strictEqual(sFormattedDate, \"Yesterday\");\n\t});\n});\n```\n\nThe next test verifies that ***Yesterday*** is returned for yesterday's date. To keep the test independent of the system time, we pass on a stable date to the formatter.\n\n\n\n## webapp/model/DateFormatter.js\n\n```js\nsap.ui.define([\n\t\"sap/ui/base/Object\",\n\t\"sap/ui/core/format/DateFormat\"\n], function(Object, DateFormat) {\n\treturn Object.extend(\"sap.ui.demo.bulletinboard.model.DateFormatter\", {\n\t\tconstructor : function(oProperties) {\n\t\t\tthis.timeFormat = DateFormat.getTimeInstance({\n\t\t\t\tstyle : \"short\"\n\t\t\t}, oProperties.locale);\n\t\t\tthis.now = oProperties.now;\n\t\t},\n\t\tformat : function(oDate) {\n\t\t\tif (!oDate) {\n\t\t\t\treturn \"\";\n\t\t\t}\n\t\t\tvar iElapsedDays = this._getElapsedDays(oDate);\n\t\t\tif (iElapsedDays === 0) {\n\t\t\treturn this.timeFormat.format(oDate);\n\t\t\t} else if (iElapsedDays === 1) {\n\t\t\t\treturn \"Yesterday\";\n\t\t\t}\n\t\t},\n\t\t_getElapsedDays : function(oDate) {\n\t\t\tvar iElapsedMilliseconds = this.now() - oDate.getTime();\n\t\t\tvar fElapsedDays = iElapsedMilliseconds / 1000 / 60 / 60 / 24;\n\t\t\treturn Math.floor(fElapsedDays);\n\t\t}\n\t});\n});\n```\n\nIn the implementation we add a calculation for determining how many days passed. If zero days passed, the format function is called, and if one day passed ***Yesterday*** is returned. Currently we skip reading \"Yesterday\" from the i18n model to keep the example simple.\n\n\n\n<a name=\"loiobc4114a88e4d4ac1a0f53b2a7a92b226__section_cw1_q4v_cdc\"/>\n\n## Boundary Testing:\n\n\n\n<a name=\"loiobc4114a88e4d4ac1a0f53b2a7a92b226__section_dw1_q4v_cdc\"/>\n\n## webapp/test/unit/model/DateFormatter.js\n\n```js\nsap.ui.define([\n\t\"sap/ui/demo/bulletinboard/model/DateFormatter\",\n\t\"sap/ui/core/Locale\",\n\t\"sap/ui/core/date/UI5Date\"\n], function(DateFormatter, Locale, UI5Date) {\n\tvar oFormatter = null;\n\t// ...\n\tQUnit.test(\"Should return day of the week if date < 7 days ago\", function(assert) {\n\t\tvar oDate = UI5Date.getInstance(2015, 2, 8);\n\t\tvar sFormattedDate = oFormatter.format(oDate);\n\t\tassert.strictEqual(sFormattedDate, \"Sunday\");\n\t});\n});\n```\n\nThe next test verifies that the day of the week is returned. As test input we take a value at the boundary: Sunday is one day before a different formatting pattern should be applied.\n\n\n\n## webapp/model/DateFormatter.js\n\n```js\nsap.ui.define([\n\t\"sap/ui/base/Object\",\n\t\"sap/ui/core/format/DateFormat\"\n], function(Object, DateFormat) {\n\treturn Object.extend(\"sap.ui.demo.bulletinboard.model.DateFormatter\", {\n\t\tconstructor: function(oProperties) {\n\t\t\tthis.timeFormat = DateFormat.getTimeInstance({\n\t\t\t\tstyle: \"short\"\n\t\t\t}, oProperties.locale);\n\t\t\tthis.weekdayFormat = DateFormat.getDateInstance({\n\t\t\t\tpattern: \"EEEE\"\n\t\t\t}, oProperties.locale);\n\t\t\tthis.now = oProperties.now;\n\t\t},\n\t\tformat: function(oDate) {\n\t\t\tif (!oDate) {\n\t\t\t\treturn \"\";\n\t\t\t}\n\t\t\tvar iElapsedDays = this._getElapsedDays(oDate);\n\t\t\tif (iElapsedDays === 0) {\n\t\t\t\treturn this.timeFormat.format(oDate);\n\t\t\t} else if (iElapsedDays === 1) {\n\t\t\t\treturn \"Yesterday\";\n\t\t\t} else if (iElapsedDays < 7) {\n\t\t\t\treturn this.weekdayFormat.format(oDate);\n\t\t\t}\n\t\t}\n\n```\n\nNow we define a new format in our constructor, the `weekdayFormat`. In the format function we apply the format if the elapsed days are smaller than 7.\n\n\n\n## webapp/test/unit/model/DateFormatter.js\n\n```js\nsap.ui.define([\n\t\"sap/ui/demo/bulletinboard/model/DateFormatter\",\n\t\"sap/ui/core/Locale\",\n\t\"sap/ui/core/date/UI5Date\"\n], function(DateFormatter, Locale, UI5Date) {\n\tvar oFormatter = null;\n\t// ...\n\tQUnit.test(\"Should return date w/o time if date > 7 days ago\", function(assert) {\n\t\tvar oDate = UI5Date.getInstance(2015, 2, 7);\n\t\tvar sFormattedDate = oFormatter.format(oDate);\n\t\tassert.strictEqual(sFormattedDate, \"Mar 7, 2015\");\n\t});\n});\n```\n\nIn the next test we verify that the date is formatted as date without time. Again, we take a value at the boundary.\n\n\n\n## webapp/model/DateFormatter.js\n\n```js\nâ€¦\n\t\tconstructor: function(oProperties) {\n\t\t\tthis.timeFormat = DateFormat.getTimeInstance({\n\t\t\t\tstyle : \"short\"\n\t\t\t}, oProperties.locale);\n\t\t\tthis.weekdayFormat = DateFormat.getDateInstance({\n\t\t\t\tpattern : \"EEEE\"\n\t\t\t}, oProperties.locale);\n\t\t\tthis.dateFormat = DateFormat.getDateInstance({\n\t\t\t\tstyle : \"medium\"\n\t\t\t}, oProperties.locale);\n\t\t\tthis.now = oProperties.now;\n\t\t},\n\t\tformat: function(oDate) {\n\t\t\tif (!oDate) {\n\t\t\t\treturn \"\";\n\t\t\t}\n\t\t\tvar iElapsedDays = this._getElapsedDays(oDate);\n\t\t\tif (iElapsedDays === 0) {\n\t\t\t\treturn this.timeFormat.format(oDate);\n\t\t\t} else if (iElapsedDays === 1) {\n\t\t\t\treturn \"Yesterday\";\n\t\t\t} else if (iElapsedDays < 7) {\n\t\t\t\treturn this.weekdayFormat.format(oDate);\n\t\t\t} else {\n\t\t\t\treturn this.dateFormat.format(oDate);\n\t\t\t}\n\n\t\t},\n\n```\n\nIn the implementation, we use a different `style` property for instantiating the `dateFormat` property. We call the format of this instance for dates that are more than 6 days in the past.\n\nAlthough our formatter depends on system time and locale settings, our tests are very easy to read and maintain. We wrote blackbox tests, providing only the input and expecting a certain output without knowing the implementation details. The `DateFormatter` does not actively resolve the dependencies to the system time and locale settings. Instead, it asks its creator to pass the dependencies along in the constructor. In the next step, we have to bring the pieces together.\n\n",
  "excerpt": "<!-- loiobc4114a88e4d4ac1a0f53b2a7a92b226 --> Step 15: Writing a Short Date Formatter Using TDD It's now time to improve the content of the Info tab. We want to see the Posted At date in a formatted w...",
  "wordCount": 1746,
  "version": "1.0.0",
  "source": "sapui5",
  "sourceType": "github"
}